webpackJsonp([1],{"+skl":function(e,t){},0:function(e,t){},"0rPL":function(e,t){},"3Qlf":function(e,t){},"9OcB":function(e,t){},JLLG:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("7+uW"),a={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var n=s("VU/8")({name:"App"},a,!1,function(e){s("yoKA")},null,null).exports,o=s("2bvH"),i=s("/ocq"),l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"demo-avatar"},[t("Avatar",{style:{background:this.bgc},attrs:{src:this.src}},[this._v(this._s(this.avatarName))])],1)},staticRenderFns:[]},u=s("VU/8")({props:["src","avatarName","bgc"]},l,!1,null,null,null).exports,c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("Input",{attrs:{search:"",placeholder:"搜索"}})],1)},staticRenderFns:[]},d=s("VU/8")({},c,!1,null,null,null).exports,m={data:function(){return{notify:!1,isTouch:!1,color:"#008B8B"}},props:["userlist","useradd","userdel"],watch:{useradd:function(){-1===this.userlist.indexOf(this.useradd[1])&&this.userlist.push(this.useradd[1])},userdel:function(){var e=this.userlist.indexOf(this.userdel[1]);e>-1&&this.userlist.splice(e,1)},userlist:function(){this.$store.commit("changeUserlist",this.userlist)},"$store.state.notify":function(){document.getElementById(this.$store.state.notify).getElementsByTagName("i")[0].style.display=""}},methods:{withChat:function(e){var t=document.getElementById(e).getElementsByTagName("i")[0];"none"!==t.style.display&&(t.style.display="none"),this.$store.commit("changeClick",e),this.$store.commit("changeUser",e)}},components:{Avatar:u}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{width:"320px"}},e._l(e.userlist,function(t,r){return s("div",{key:r,staticClass:"userlist",on:{click:function(s){return e.withChat(t)}}},[s("Card",{attrs:{id:t}},[s("div",{staticStyle:{"text-align":"center"}},[s("Icon",{staticStyle:{float:"right",color:"red",display:"none"},attrs:{type:"ios-text",size:"20"}}),e._v(" "),s("Avatar",{style:{float:"left"},attrs:{avatarName:t,bgc:e.color}}),e._v(" "),s("p",[e._v(e._s(t))])],1)])],1)}),0)},staticRenderFns:[]};var p=s("VU/8")(m,h,!1,function(e){s("9OcB")},null,null).exports,f=s("Gu7T"),g=s.n(f),v=s("BO1k"),y=s.n(v),b=s("aFK5"),x=s.n(b),_=s("fZjL"),M=s.n(_),w={name:"Messages",components:{Avatar:u},props:["my","store","bgc"],data:function(){return{messages:[],storeMessage:{}}},mounted:function(){var e=this;window.addEventListener("beforeunload",function(t){return e.beforeunloadHandler(t)})},methods:{beforeunloadHandler:function(e){var t=sessionStorage.getItem("username");this.$socket.emit("storeMessage",[t,this.storeMessage])}},watch:{my:function(){var e=this,t=this.$store.state.privateUser;this.storeMessage.hasOwnProperty(this.my[2])?this.my[3]?this.storeMessage[this.my[2]].push(["myself",this.my[0],"avatarMyself"]):(this.$store.commit("beNotify",this.my[2]),this.storeMessage[this.my[2]].push(["other",this.my[0],"avatarOther",this.my[2]])):(this.storeMessage[this.my[2]]=[],this.my[3]?this.storeMessage[this.my[2]].push(["myself",this.my[0],"avatarMyself"]):(this.$store.commit("beNotify",this.my[2]),this.storeMessage[this.my[2]].push(["other",this.my[0],"avatarOther",this.my[2]]))),this.storeMessage.hasOwnProperty(t)&&(this.messages=[],this.storeMessage[t].forEach(function(t){e.messages.push(t)}))},store:function(){if(this.store){var e=JSON.parse(this.store);if(M()(this.storeMessage).length||(this.storeMessage=e),M()(this.storeMessage).length){var t=x()(e),s=!0,r=!1,a=void 0;try{for(var n,o=y()(t);!(s=(n=o.next()).done);s=!0){var i=n.value;this.storeMessage.hasOwnProperty(i)&&(this.storeMessage[i]=[].concat(g()(e[i]),g()(this.storeMessage[i])))}}catch(e){r=!0,a=e}finally{try{!s&&o.return&&o.return()}finally{if(r)throw a}}}}},"$store.state.privateUser":function(){var e=this;this.messages=[];var t=this.$store.state.privateUser;this.storeMessage.hasOwnProperty(t)&&this.storeMessage[t].forEach(function(t){e.messages.push(t)})}},computed:{},destroyed:function(){var e=this;window.removeEventListener("beforeunload",function(t){return e.beforeunloadHandler(t)})}},C={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",[e.messages?s("ul",e._l(e.messages,function(t,r){return s("li",{key:r,class:t[0]},[s("p",[e._v(e._s(t[1]))]),e._v(" "),"avatarOther"===t[2]?s("div",{staticClass:"thunb"},[s("Avatar",{class:t[2],attrs:{avatarName:t[3]}})],1):s("div",{staticClass:"thunb"},[s("Avatar",{class:t[2],attrs:{bgc:e.bgc}})],1)])}),0):e._e()])])},staticRenderFns:[]};var $=s("VU/8")(w,C,!1,function(e){s("JLLG")},null,null).exports,k=(s("Ya8g"),{name:"FirstPage",data:function(){return{clientName:sessionStorage.getItem("username"),isConnect:!1,userList:[],userAdd:"",userAddindex:0,userDel:"",userDelindex:0,myValue:"",myprop:[],myIndex:0,storeData:"",src:"",bgc:"",arName:"Me"}},methods:{gotMyMsg:function(){var e=this.$store.state.privateUser;""!==this.myValue&&e?(this.myprop=[],this.myprop.push(this.myValue,this.myIndex,e,"myself"),this.$refs.contentid.scrollTop=this.$refs.contentid.scrollHeight,this.$socket.emit("privateChat",[e,this.myValue]),this.myValue="",this.myIndex++):this.$Message.error("请选择需要发送消息的联系人")}},watch:{},beforeCreate:function(){sessionStorage.getItem("username")||this.$router.push("/")},beforeMount:function(){Math.floor(4*Math.random());this.bgc=["#90EE90","#8B008B","#DC143C","#FFD700","#FF6347"][Math.floor(4*Math.random())],console.log(this.bgc)},mounted:function(){this.$socket.emit("connect","")},sockets:{connect:function(){console.log("socket connect success!"),sessionStorage.getItem("username")&&this.$socket.emit("logined message",sessionStorage.getItem("username"))},loginedUserList:function(e){var t=e.indexOf(sessionStorage.getItem("username"));t>-1&&e.splice(t,1),this.userList=e},userManageAdd:function(e){this.userAdd=[this.userAddindex,e],this.userAddindex++},userManageDel:function(e){this.userDel=[this.userDelindex,e],this.userDelindex++},privateChat:function(e){this.myprop=[],this.myprop.push(e[1],this.otherIndex,e[0]),this.$refs.contentid.scrollTop=this.$refs.contentid.scrollHeight,this.myIndex++},storeMessage:function(e){this.storeData=e}},components:{Avatar:u,Search:d,UserList:p,Messages:$}}),N={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"layout"},[s("Layout",[s("Header",[s("Menu",{attrs:{mode:"horizontal",theme:"dark","active-name":"1"}},[s("div",{staticClass:"layout-logo"}),e._v(" --\x3e\n          "),s("Avatar",{style:{float:"left"},attrs:{bgc:e.bgc,avatarName:e.arName}}),e._v(" "),s("h2",{staticStyle:{color:"white",float:"left","margin-left":"10px"}},[e._v(e._s(e.clientName))]),e._v(" "),s("Search",{style:{width:"200px",float:"right"}})],1)],1),e._v(" "),s("Layout",[s("Sider",{style:{background:"#fff",height:"536px"},attrs:{"hide-trigger":""}},[s("UserList",{attrs:{userlist:e.userList,useradd:e.userAdd,userdel:e.userDel}})],1),e._v(" "),s("Layout",{style:{padding:"19px"}},[s("Content",{ref:"contentid",staticClass:"content"},[s("Messages",{attrs:{my:e.myprop,store:e.storeData,bgc:e.bgc}})],1),e._v(" "),s("Content",{style:{height:"130px",background:"#fff",marginTop:"10px"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.myValue,expression:"myValue"}],style:{width:"762px",height:"90px",resize:"none",outline:"none",border:"none",fontSize:"20px"},attrs:{name:"textarea"},domProps:{value:e.myValue},on:{input:function(t){t.target.composing||(e.myValue=t.target.value)}}}),e._v(" "),s("button",{staticClass:"sendButton",on:{click:e.gotMyMsg}},[e._v("发送")])])],1)],1)],1)],1)},staticRenderFns:[]};var P=s("VU/8")(k,N,!1,function(e){s("0rPL")},"data-v-fea992e2",null).exports,I={name:"Login",data:function(){return{username:"",password:"",registerName:"",registerPassword:"",missPassOrUser:!1,modal:!1}},methods:{loginfunc:function(){var e=this,t=this.username;this.$http.post("http://localhost:3000/Login",{username:this.username,password:this.password},{emulateJSON:!0}).then(function(s){"OK"===s.bodyText?(sessionStorage.setItem("username",t),e.$router.push("/Chat")):e.missPassOrUser=!0},function(t){e.$Message.error("系统出错啦，等下再试"),console.log(t)}),this.username="",this.password=""},register:function(){var e=this;this.$http.post("http://localhost:3000/Register",{username:this.registerName,password:this.registerPassword},{emulateJSON:!0}).then(function(t){"OK"===t.bodyText?(e.$Message.success("注册成功！请重新登录"),e.registerName="",e.registerPassword="",e.modal=!1):"repeated"===t.bodyText&&(e.$Message.error("该用户已存在，请认真核对再后注册"),e.registerName="",e.registerPassword="")},function(t){e.$Message.error("系统出错啦，等下再试"),console.log(t)})}}},L={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"register"},[s("button",{staticClass:"hoverit",on:{click:function(t){e.modal=!0}}},[e._v("注册")])]),e._v(" "),s("Modal",{attrs:{width:"360"},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[s("p",{staticStyle:{color:"rgb(25, 190, 107)","text-align":"center"},attrs:{slot:"header"},slot:"header"},[s("Icon",{attrs:{type:"ios-information-circle"}}),e._v(" "),s("span",[e._v("注册列表")])],1),e._v(" "),s("div",{staticStyle:{"text-align":"center"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.registerName,expression:"registerName"}],staticClass:"registerInput",attrs:{type:"text",placeholder:"输入注册用户名"},domProps:{value:e.registerName},on:{input:function(t){t.target.composing||(e.registerName=t.target.value)}}}),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.registerPassword,expression:"registerPassword"}],staticClass:"registerInput",attrs:{type:"text",placeholder:"输入密码"},domProps:{value:e.registerPassword},on:{input:function(t){t.target.composing||(e.registerPassword=t.target.value)}}})]),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"success",size:"large",long:""},on:{click:e.register}},[e._v("确认注册")])],1)]),e._v(" "),s("Card",{staticClass:"login",style:{width:"450px",height:"145px"}},[s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"enterBox",attrs:{type:"text",name:"user",placeholder:"输入用户名",autocomplete:"off"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"enterBox",attrs:{type:"text",name:"password",placeholder:"输入密码",autocomplete:"off"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("button",{staticClass:"enterBox loginBox",on:{click:e.loginfunc}},[e._v("登录")]),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.missPassOrUser,expression:"missPassOrUser"}],staticClass:"loginMiss"},[e._v("登录密码或帐号错误，请重新登录")])])])],1)},staticRenderFns:[]};var O=s("VU/8")(I,L,!1,function(e){s("3Qlf")},null,null).exports;r.default.use(i.a);var S=new i.a({routes:[{path:"/",name:"Login",component:O},{path:"/Chat",name:"Chat",component:P}]}),U=s("BTaQ");s("+skl");r.default.component("Button",U.Button),r.default.component("Card",U.Card),r.default.component("Layout",U.Layout),r.default.component("MenuItem",U.MenuItem),r.default.component("Header",U.Header),r.default.component("Menu",U.Menu),r.default.component("Icon",U.Icon),r.default.component("Sider",U.Sider),r.default.component("Submenu",U.Submenu),r.default.component("Avatar",U.Avatar),r.default.component("Input",U.Input),r.default.component("Modal",U.Modal);var B=s("8+8L"),A=s("Oprb"),E=s.n(A);r.default.prototype.$Message=U.Message,r.default.use(o.a);var V=new o.a.Store({state:{userList:[],privateUser:"",beforePrivateUser:"nobody",beClick:[],notify:""},getters:{},mutations:{changeUserlist:function(e,t){e.userList=t},changeUser:function(e,t){e.beforePrivateUser=e.privateUser,e.privateUser=t},changeClick:function(e,t){e.beClick.length&&e.userList.indexOf(e.beClick[0])>-1?(document.getElementById(e.beClick[0]).style.background="#fff",e.beClick.pop(),document.getElementById(t).style.background="gray",e.beClick.push(t)):(document.getElementById(t).style.background="gray",e.beClick.pop(),e.beClick.push(t))},beNotify:function(e,t){e.notify=t}}});r.default.use(new E.a({connection:"http://localhost:3000",vuex:{store:V,actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"}})),r.default.use(B.a),r.default.config.productionTip=!1,new r.default({el:"#app",store:V,router:S,components:{App:n},template:"<App/>"})},yoKA:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.0617276ee784bce2da88.js.map